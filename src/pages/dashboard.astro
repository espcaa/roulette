---
import Layout from '../layouts/Layout.astro';
import Background from '../components/Background.astro';

import jwt from 'jsonwebtoken';
import { redirect } from 'astro';

export const prerender = false;
const cookieHeader = Astro.request.headers.get('cookie') || '';
console.log('cookie header:', Astro.request.headers.get('cookie'));

const cookies = Object.fromEntries(cookieHeader.split('; ').map(c => {
  const [key, ...v] = c.split('=');
  return [key, v.join('=')];
}));

const token = cookies.token;

let user = null;

try {
  user = jwt.verify(token, process.env.JWT_SECRET);
} catch {
  return new Response(null, {
    status: 302,
    headers: {
      Location: '/',
    },
    });

}
---

<Layout>
<main>
<Background>
</Background>
<div class="foreground">
<p>Welcome, {user.userId}!</p>

</div>

</main>
</Layout>


<style>
	main {
		width: 100%;
		height: 100%;
		text-align: center;

		overflow: hidden;
	}

	main > div {
		position: absolute;
		width: 100%;
		height: 100%;
	}
  </style>
